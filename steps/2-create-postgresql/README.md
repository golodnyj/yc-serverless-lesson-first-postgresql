# Yandex Managed Service for PostgreSQL
## Создание кластера PostgreSQL

Конечно кластер PostgreSQL можно создать с помощью UI, но в этой лабораторной работе мы используем CLI. Прежде всего мы определим подсеть в которой будет расположен наш кластер. Мы будем располагать кластер в зоне `ru-central1-c` и с помощью следующей команды узнаем `ID` соответствующей подсети:

    yc vpc subnet list

Создадим кластера версии PostgreSQL `13` с именем `my-pg-database`. Установим тип хоста burstable `b2.nano` — это самый дешёвый и простой вариант хоста. Из-за невысокой производительности он подходит только для тестовых целей. При этом, для хоста используем диск hdd-диск размером 10 гигабайт.

При создании сразу создадим пользователя с именем `user1` и паролем `user1user1`, для этого пользователя создадим базу данных `db1`. И для дальнейшего удобства администрирования откроем доступ из консоли управления, для этого используется опция `websql-access` — это позволит выполнять SQL запросы прямо в UI. Чтобы открыть возможность подключения к PostgreSQL из функции необходимо подключить опцию `serverless-access`.

Следующая команда на несколько минут создаст кластер PostgreSQL, не забудьте подставить `ID` вашей подсети:

    yc managed-postgresql cluster create \
    --name my-pg-database \
    --description 'For Serverless' \
    --postgresql-version 13 \
    --environment production \
    --network-name default \
    --resource-preset b2.nano \
    --host zone-id=ru-central1-c,subnet-id=<ID> \
    --disk-type network-hdd \
    --disk-size 10 \
    --user name=user1,password=user1user1 \
    --database name=db1,owner=user1 \
    --websql-access \
    --serverless-access

После успешного создания кластера проверим результат:

    yc managed-postgresql cluster list
    yc managed-postgresql cluster get <имя или идентификатор кластера>

## Создание таблицы для хранения данных

Мы использовали опцию `websql-access`, что открывает нам возможности по исполнению SQL в UI. Воспользуемся этим и создадим таблицу в созданной нами базе данных. В эту таблицу мы будем складывать результаты выполнения нашей функции. В консоли управления перейдите в рабочий каталог, в котором создан кластер PostgreSQL. Откройте сервис Managed Service for PostgreSQL и перейдите в кластер `my-pg-database`.

В боковом меню перейдите на вкладку `SQL`. Для базы данных `db1`введите имя `user1` и пароль `user1user1`, в открывшемся окне введите SQL запрос и исполните его:

В боковом меню перейдите на вкладку `SQL`. Для базы данных `db1`введите имя `user1` и пароль `user1user1`, нажмите кнопку `Подключиться`.

В открывшемся окне введите SQL запрос и исполните его:

    CREATE TABLE measurements (
        result integer,
        time float
    );

Успешное выполнение команды создаст таблицу, куда мы будем складывать результаты.


